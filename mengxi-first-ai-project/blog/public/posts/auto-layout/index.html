<!DOCTYPE html>
<html lang="zh-cn">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Layout | Mengxi&#39;s Blog</title>


<link href="https://fonts.googleapis.com" rel="preconnect" />
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
<link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />


<link rel="stylesheet" href="/css/unified-styles.css">
</head>

<body class="theme-knowledge">
    <nav class="u-nav">
    <div class="u-container u-nav__container">
        <a href="http://localhost:1313/" class="u-nav__brand">
            <span class="u-nav__logo-emoji">ðŸŒ¿</span> Mengxi&#39;s Blog
        </a>
        <ul class="u-nav__links">
            
            <li><a href="/" class="u-nav__link ">Home</a></li>
            
            <li><a href="/posts" class="u-nav__link ">Posts</a></li>
            
            <li><a href="/search" class="u-nav__link ">Search</a></li>
            
            <li><a href="/timeline/" class="u-nav__link ">Timeline</a></li>
            
            <li><a href="/guide/" class="u-nav__link ">Guide</a></li>
            
            <li><a href="/upload/" class="u-nav__link ">Upload</a></li>
            
        </ul>
    </div>
</nav>

    <main class="u-container u-py-xl">
        
<header class="u-text-center u-mb-xl">
    <h1>Auto Layout</h1>
    <div class="u-flex u-justify-center u-gap-md u-text-light">
        <span>Dec 14, 2025</span>
        <span>â€¢</span>
        <span>6 min read</span>
    </div>
</header>

<article class="u-card" style="max-width: 800px; margin: 0 auto;">
    <div class="content">
        <p>/*</p>
<p><img src="https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-download-raw.jpg" alt=""></p>
<p>Download this file and save to your Obsidian Vault including the first line, or open it in &ldquo;Raw&rdquo; and copy the entire contents to Obsidian.</p>
<p><img src="https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-auto-layout.png" alt=""></p>
<p>This script performs automatic layout for the selected top-level grouping objects. It is powered by <a href="https://github.com/kieler/elkjs">elkjs</a> and needs to be connected to the Internet.</p>
<p>See documentation for more details:
<a href="https://zsviczian.github.io/obsidian-excalidraw-plugin/ExcalidrawScriptsEngine.html">https://zsviczian.github.io/obsidian-excalidraw-plugin/ExcalidrawScriptsEngine.html</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">!</span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">verifyMinimumPluginVersion</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">!</span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">verifyMinimumPluginVersion</span>(<span style="color:#e6db74">&#34;1.5.21&#34;</span>)
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Notice</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;This script requires a newer version of Excalidraw. Please install the latest version.&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">settings</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getScriptSettings</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//set default values on first run
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">settings</span>[<span style="color:#e6db74">&#34;Layout Options JSON&#34;</span>]) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">settings</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Layout Options JSON&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;450px&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`{\n      &#34;org.eclipse.elk.layered.crossingMinimization.semiInteractive&#34;: &#34;true&#34;,\n      &#34;org.eclipse.elk.layered.considerModelOrder.components&#34;: &#34;FORCE_MODEL_ORDER&#34;\n}`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`You can use layout options to configure the layout algorithm. A list of all options and further details of their exact effects is available in &lt;a href=&#34;http://www.eclipse.org/elk/reference.html&#34; rel=&#34;nofollow&#34;&gt;ELK&#39;s documentation&lt;/a&gt;.`</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">setScriptSettings</span>(<span style="color:#a6e22e">settings</span>);
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">ELK</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;undefined&#34;</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">loadELK</span>(<span style="color:#a6e22e">doAutoLayout</span>);
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">doAutoLayout</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">doAutoLayout</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selectedElements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getViewSelectedElements</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">groups</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getMaximumGroups</span>(<span style="color:#a6e22e">selectedElements</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">g</span>) =&gt; <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">el</span>) =&gt; <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">containerId</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>)) <span style="color:#75715e">// ignore text in stickynote
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">els</span>) =&gt; <span style="color:#a6e22e">els</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stickynotesMap</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedElements</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">el</span>) =&gt; <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">containerId</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">el</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">containerId</span>, <span style="color:#a6e22e">el</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>    }, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elk</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ELK</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">knownLayoutAlgorithms</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">elk</span>.<span style="color:#a6e22e">knownLayoutAlgorithms</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">layoutAlgorithms</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">knownLayoutAlgorithms</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">knownLayoutAlgorithm</span>) =&gt; ({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">displayText</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.layered&#34;</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.radial&#34;</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.mrtree&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;* &#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">description</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">:</span> <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">description</span>,
</span></span><span style="display:flex;"><span>    }))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">sort</span>((<span style="color:#a6e22e">lha</span>, <span style="color:#a6e22e">rha</span>) =&gt; <span style="color:#a6e22e">lha</span>.<span style="color:#a6e22e">displayText</span>.<span style="color:#a6e22e">localeCompare</span>(<span style="color:#a6e22e">rha</span>.<span style="color:#a6e22e">displayText</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">layoutAlgorithmsSimple</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">knownLayoutAlgorithms</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">knownLayoutAlgorithm</span>) =&gt; ({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">displayText</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.layered&#34;</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.radial&#34;</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.mrtree&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;* &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">:</span> <span style="color:#a6e22e">knownLayoutAlgorithm</span>.<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    }))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">sort</span>((<span style="color:#a6e22e">lha</span>, <span style="color:#a6e22e">rha</span>) =&gt; <span style="color:#a6e22e">lha</span>.<span style="color:#a6e22e">displayText</span>.<span style="color:#a6e22e">localeCompare</span>(<span style="color:#a6e22e">rha</span>.<span style="color:#a6e22e">displayText</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// const knownOptions = knownLayoutAlgorithms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//   .reduce(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//     (result, knownLayoutAlgorithm) =&gt; [
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//       ...result,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//       ...knownLayoutAlgorithm.knownOptions,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//     ],
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//     []
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//   )
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//   .filter((value, index, self) =&gt; self.indexOf(value) === index) // remove duplicates
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//   .sort((lha, rha) =&gt; lha.localeCompare(rha));
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// console.log(&#34;knownOptions&#34;, knownOptions);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selectedAlgorithm</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">suggester</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">layoutAlgorithms</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">algorithmInfo</span>) =&gt; <span style="color:#a6e22e">algorithmInfo</span>.<span style="color:#a6e22e">displayText</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">layoutAlgorithms</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">algorithmInfo</span>) =&gt; <span style="color:#a6e22e">algorithmInfo</span>.<span style="color:#a6e22e">id</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Layout algorithm&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">knownNodePlacementStrategy</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;SIMPLE&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;INTERACTIVE&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;LINEAR_SEGMENTS&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;BRANDES_KOEPF&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;NETWORK_SIMPLEX&#34;</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">knownDirections</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;UNDEFINED&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;RIGHT&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;LEFT&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;DOWN&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;UP&#34;</span>
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nodePlacementStrategy</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BRANDES_KOEPF&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">componentComponentSpacing</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nodeNodeSpacing</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;100&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nodeNodeBetweenLayersSpacing</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;100&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">discoComponentLayoutAlgorithm</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;org.eclipse.elk.layered&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">direction</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UNDEFINED&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">selectedAlgorithm</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.layered&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodePlacementStrategy</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">suggester</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">knownNodePlacementStrategy</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">knownNodePlacementStrategy</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Node placement strategy&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selectedDirection</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">suggester</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">knownDirections</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">knownDirections</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Direction&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">direction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedDirection</span><span style="color:#f92672">??</span><span style="color:#e6db74">&#34;UNDEFINED&#34;</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">selectedAlgorithm</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.disco&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">componentLayoutAlgorithms</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layoutAlgorithmsSimple</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">al</span> =&gt; <span style="color:#a6e22e">al</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;org.eclipse.elk.disco&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selectedDiscoComponentLayoutAlgorithm</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">suggester</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">componentLayoutAlgorithms</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">algorithmInfo</span>) =&gt; <span style="color:#a6e22e">algorithmInfo</span>.<span style="color:#a6e22e">displayText</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">componentLayoutAlgorithms</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">algorithmInfo</span>) =&gt; <span style="color:#a6e22e">algorithmInfo</span>.<span style="color:#a6e22e">id</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Disco Connected Components Layout Algorithm&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">discoComponentLayoutAlgorithm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedDiscoComponentLayoutAlgorithm</span><span style="color:#f92672">??</span><span style="color:#e6db74">&#34;org.eclipse.elk.layered&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selectedAlgorithm</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.box&#34;</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selectedAlgorithm</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;org.eclipse.elk.rectpacking&#34;</span>
</span></span><span style="display:flex;"><span>  ) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodeNodeSpacing</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">inputPrompt</span>(<span style="color:#e6db74">&#34;Node Spacing&#34;</span>, <span style="color:#e6db74">&#34;number&#34;</span>, <span style="color:#e6db74">&#34;10&#34;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">userSpacingStr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">inputPrompt</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Components Spacing, Node Spacing, Node Node Between Layers Spacing&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;number, number, number&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;10, 100, 100&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">userSpacingArr</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">userSpacingStr</span><span style="color:#f92672">??</span><span style="color:#e6db74">&#34;&#34;</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;,&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">componentComponentSpacing</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">userSpacingArr</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">??</span> <span style="color:#e6db74">&#34;10&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodeNodeSpacing</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">userSpacingArr</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">??</span> <span style="color:#e6db74">&#34;100&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodeNodeBetweenLayersSpacing</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">userSpacingArr</span>[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">??</span> <span style="color:#e6db74">&#34;100&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">layoutOptionsJson</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">layoutOptionsJson</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">settings</span>[<span style="color:#e6db74">&#34;Layout Options JSON&#34;</span>].<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Notice</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Error reading Layout Options JSON, see developer console for more information&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">4000</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;elk.algorithm&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedAlgorithm</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;org.eclipse.elk.spacing.componentComponent&#34;</span>] <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">componentComponentSpacing</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;org.eclipse.elk.spacing.nodeNode&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">nodeNodeSpacing</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;org.eclipse.elk.layered.spacing.nodeNodeBetweenLayers&#34;</span>] <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodeNodeBetweenLayersSpacing</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;org.eclipse.elk.layered.nodePlacement.strategy&#34;</span>] <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodePlacementStrategy</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;org.eclipse.elk.disco.componentCompaction.componentLayoutAlgorithm&#34;</span>] <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">discoComponentLayoutAlgorithm</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layoutOptionsJson</span>[<span style="color:#e6db74">&#34;org.eclipse.elk.direction&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">direction</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">graph</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">layoutOptions</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">layoutOptionsJson</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">children</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">edges</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">groupMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">targetElkMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">arrowEls</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">groups</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;arrow&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;line&#34;</span>)
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;arrow&#34;</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">startBinding</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">endBinding</span>
</span></span><span style="display:flex;"><span>      ) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">arrowEls</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">elkId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;g&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">el</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">elkId</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>      }, <span style="color:#a6e22e">targetElkMap</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">box</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getBoundingBox</span>(<span style="color:#a6e22e">elements</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">groupMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">elkId</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">elements</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">elements</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">boundingBox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">box</span>,
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">graph</span>.<span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">elkId</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">box</span>.<span style="color:#a6e22e">width</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">box</span>.<span style="color:#a6e22e">height</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">box</span>.<span style="color:#a6e22e">topX</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">box</span>.<span style="color:#a6e22e">topY</span>,
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">arrowEls</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arrowEl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrowEls</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startElkId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">targetElkMap</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">arrowEl</span>.<span style="color:#a6e22e">startBinding</span>.<span style="color:#a6e22e">elementId</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endElkId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">targetElkMap</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">arrowEl</span>.<span style="color:#a6e22e">endBinding</span>.<span style="color:#a6e22e">elementId</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">graph</span>.<span style="color:#a6e22e">edges</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;e&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sources</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">startElkId</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">targets</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">endElkId</span>],
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">initTopX</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    Math.<span style="color:#a6e22e">min</span>(...Array.<span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">groupMap</span>.<span style="color:#a6e22e">values</span>()).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">v</span>) =&gt; <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">boundingBox</span>.<span style="color:#a6e22e">topX</span>)) <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">12</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">initTopY</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    Math.<span style="color:#a6e22e">min</span>(...Array.<span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">groupMap</span>.<span style="color:#a6e22e">values</span>()).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">v</span>) =&gt; <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">boundingBox</span>.<span style="color:#a6e22e">topY</span>)) <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">12</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">elk</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">layout</span>(<span style="color:#a6e22e">graph</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">resultGraph</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elkEl</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">resultGraph</span>.<span style="color:#a6e22e">children</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">group</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groupMap</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">elkEl</span>.<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">groupEl</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">elements</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">originalDistancX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">boundingBox</span>.<span style="color:#a6e22e">topX</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">originalDistancY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">boundingBox</span>.<span style="color:#a6e22e">topY</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">groupElDistanceX</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">elkEl</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">initTopX</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">originalDistancX</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">x</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">groupElDistanceY</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">elkEl</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">initTopY</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">originalDistancY</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">y</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">groupElDistanceX</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">groupElDistanceY</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">stickynotesMap</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">id</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stickynote</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stickynotesMap</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">groupEl</span>.<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">stickynote</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stickynote</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">groupElDistanceX</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">stickynote</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stickynote</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">groupElDistanceY</span>;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">copyViewElementsToEAforEditing</span>(<span style="color:#a6e22e">selectedElements</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addElementsToView</span>(<span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">normalizeSelectedArrows</span>();
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">loadELK</span>(<span style="color:#a6e22e">doAfterLoaded</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">script</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;script&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">ELK</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;undefined&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">doAfterLoaded</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/elkjs@0.8.2/lib/elk.bundled.min.js&#34;</span>;
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">script</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Normalize Selected Arrows
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">normalizeSelectedArrows</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">gapValue</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">selectedIndividualArrows</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getMaximumGroups</span>(<span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getViewSelectedElements</span>())
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">g</span>) =&gt; [...<span style="color:#a6e22e">result</span>, ...<span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">el</span> =&gt; <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;arrow&#39;</span>)], []);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">allElements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getViewElements</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arrow</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">selectedIndividualArrows</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startBindingEl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">allElements</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">el</span>) =&gt; <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> (<span style="color:#a6e22e">arrow</span>.<span style="color:#a6e22e">startBinding</span> <span style="color:#f92672">||</span> {}).<span style="color:#a6e22e">elementId</span>
</span></span><span style="display:flex;"><span>    )[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endBindingEl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">allElements</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">el</span>) =&gt; <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> (<span style="color:#a6e22e">arrow</span>.<span style="color:#a6e22e">endBinding</span> <span style="color:#f92672">||</span> {}).<span style="color:#a6e22e">elementId</span>
</span></span><span style="display:flex;"><span>    )[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">startBindingEl</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">recalculateStartPointOfLine</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">arrow</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">startBindingEl</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">endBindingEl</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gapValue</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">endBindingEl</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">recalculateEndPointOfLine</span>(<span style="color:#a6e22e">arrow</span>, <span style="color:#a6e22e">endBindingEl</span>, <span style="color:#a6e22e">startBindingEl</span>, <span style="color:#a6e22e">gapValue</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">copyViewElementsToEAforEditing</span>(<span style="color:#a6e22e">selectedIndividualArrows</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addElementsToView</span>(<span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">recalculateStartPointOfLine</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">el</span>, <span style="color:#a6e22e">elB</span>, <span style="color:#a6e22e">gapValue</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bX</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">elB</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">?</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">:</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bY</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">elB</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">?</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">:</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">startBinding</span>.<span style="color:#a6e22e">gap</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gapValue</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">startBinding</span>.<span style="color:#a6e22e">focus</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">intersectA</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">intersectElementWithLine</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">el</span>,
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">bX</span>, <span style="color:#a6e22e">bY</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">aX</span>, <span style="color:#a6e22e">aY</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">startBinding</span>.<span style="color:#a6e22e">gap</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">intersectA</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">i</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-=</span> <span style="color:#a6e22e">intersectA</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">x</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">i</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-=</span> <span style="color:#a6e22e">intersectA</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">y</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">intersectA</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">intersectA</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">recalculateEndPointOfLine</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">el</span>, <span style="color:#a6e22e">elB</span>, <span style="color:#a6e22e">gapValue</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bX</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">elB</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">?</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">:</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bY</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">elB</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">?</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">elB</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">:</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">endBinding</span>.<span style="color:#a6e22e">gap</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gapValue</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">endBinding</span>.<span style="color:#a6e22e">focus</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">intersectA</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">intersectElementWithLine</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">el</span>,
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">bX</span>, <span style="color:#a6e22e">bY</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">aX</span>, <span style="color:#a6e22e">aY</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">endBinding</span>.<span style="color:#a6e22e">gap</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">intersectA</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">intersectA</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">x</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">intersectA</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">y</span>,
</span></span><span style="display:flex;"><span>    ];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>
</article>

    </main>

    <footer class="u-container u-py-xl u-text-center">
    <div class="u-mb-md">
        <span class="u-text-2xl">ðŸŒ±</span>
    </div>
    <p class="u-text-light">
        Â© 2025 Mengxi&#39;s Blog. Cultivated with intention.
    </p>
</footer>
</body>

</html>