<!DOCTYPE html>
<html lang="zh-cn">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boolean Operations | Mengxi&#39;s Blog</title>


<link href="https://fonts.googleapis.com" rel="preconnect" />
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
<link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />


<link rel="stylesheet" href="/css/unified-styles.css">
</head>

<body class="theme-knowledge">
    <nav class="u-nav">
    <div class="u-container u-nav__container">
        <a href="http://localhost:1313/" class="u-nav__brand">
            <span class="u-nav__logo-emoji">ðŸŒ¿</span> Mengxi&#39;s Blog
        </a>
        <ul class="u-nav__links">
            
            <li><a href="/" class="u-nav__link ">Home</a></li>
            
            <li><a href="/posts" class="u-nav__link ">Posts</a></li>
            
            <li><a href="/search" class="u-nav__link ">Search</a></li>
            
            <li><a href="/timeline/" class="u-nav__link ">Timeline</a></li>
            
            <li><a href="/guide/" class="u-nav__link ">Guide</a></li>
            
            <li><a href="/upload/" class="u-nav__link ">Upload</a></li>
            
        </ul>
    </div>
</nav>

    <main class="u-container u-py-xl">
        
<header class="u-text-center u-mb-xl">
    <h1>Boolean Operations</h1>
    <div class="u-flex u-justify-center u-gap-md u-text-light">
        <span>Dec 15, 2025</span>
        <span>â€¢</span>
        <span>6 min read</span>
    </div>
</header>

<article class="u-card" style="max-width: 800px; margin: 0 auto;">
    <div class="content">
        <p>/*
With This Script it is possible to make boolean Operations on Shapes.
The style of the resulting shape will be the style of the highest ranking Element that was used.
The ranking of the elements is based on their background. The &ldquo;denser&rdquo; the background, the higher the ranking (the order of backgroundstyles is shown below). If they have the same background the opacity will decide. If thats also the same its decided by the order they were created.
The ranking is also important for the difference operation, so a transparent object for example will cut a hole into a solid object.</p>
<p>See documentation for more details:
<a href="https://zsviczian.github.io/obsidian-excalidraw-plugin/ExcalidrawScriptsEngine.html">https://zsviczian.github.io/obsidian-excalidraw-plugin/ExcalidrawScriptsEngine.html</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">verifyMinimumPluginVersion</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">verifyMinimumPluginVersion</span>(<span style="color:#e6db74">&#34;1.9.20&#34;</span>)) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Notice</span>(<span style="color:#e6db74">&#34;This script requires a newer version of Excalidraw. Please install the latest version.&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ShadowGroupMarker</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ShadowCloneOf-&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getViewSelectedElements</span>().<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">el</span>=&gt;[<span style="color:#e6db74">&#34;ellipse&#34;</span>, <span style="color:#e6db74">&#34;rectangle&#34;</span>, <span style="color:#e6db74">&#34;diamond&#34;</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">type</span>) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">groupIds</span>.<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">id</span> =&gt; <span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">startsWith</span>(<span style="color:#a6e22e">ShadowGroupMarker</span>)) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>    ([<span style="color:#e6db74">&#34;line&#34;</span>, <span style="color:#e6db74">&#34;arrow&#34;</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">type</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">roundness</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Notice</span> (<span style="color:#e6db74">&#34;Select ellipses, rectangles or diamonds&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">PolyBool</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getPolyBool</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">polyboolAction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">suggester</span>([<span style="color:#e6db74">&#34;union (a + b)&#34;</span>, <span style="color:#e6db74">&#34;intersect (a &amp;&amp; b)&#34;</span>, <span style="color:#e6db74">&#34;difference (a - b)&#34;</span>, <span style="color:#e6db74">&#34;reversed difference (b - a)&#34;</span>, <span style="color:#e6db74">&#34;xor&#34;</span>], [
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">PolyBool</span>.<span style="color:#a6e22e">union</span>, <span style="color:#a6e22e">PolyBool</span>.<span style="color:#a6e22e">intersect</span>, <span style="color:#a6e22e">PolyBool</span>.<span style="color:#a6e22e">difference</span>, <span style="color:#a6e22e">PolyBool</span>.<span style="color:#a6e22e">differenceRev</span>, <span style="color:#a6e22e">PolyBool</span>.<span style="color:#a6e22e">xor</span>
</span></span><span style="display:flex;"><span>], <span style="color:#e6db74">&#34;What would you like todo with the object&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadowClones</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">element</span> =&gt; <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">groupIds</span>.<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">id</span> =&gt; <span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">startsWith</span>(<span style="color:#a6e22e">ShadowGroupMarker</span>)));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">shadowClones</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">shadowClone</span> =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">parentId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shadowClone</span>.<span style="color:#a6e22e">groupIds</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">id</span> =&gt; <span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">startsWith</span>(<span style="color:#a6e22e">ShadowGroupMarker</span>))[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">ShadowGroupMarker</span>.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shadowCloneIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">findIndex</span>(<span style="color:#a6e22e">element</span> =&gt; <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">parentId</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">shadowCloneIndex</span> <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">shadowCloneIndex</span>].<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shadowClone</span>.<span style="color:#a6e22e">backgroundColor</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">shadowCloneIndex</span>].<span style="color:#a6e22e">fillStyle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shadowClone</span>.<span style="color:#a6e22e">fillStyle</span>;
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">borderElements</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">element</span> =&gt; <span style="color:#f92672">!</span><span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">groupIds</span>.<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">id</span> =&gt; <span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">startsWith</span>(<span style="color:#a6e22e">ShadowGroupMarker</span>)));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">groups</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getMaximumGroups</span>(<span style="color:#a6e22e">borderElements</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">groups</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">group</span>) =&gt; <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">sort</span>((<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) =&gt; <span style="color:#a6e22e">RankElement</span>(<span style="color:#a6e22e">b</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">RankElement</span>(<span style="color:#a6e22e">a</span>)));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">groups</span>.<span style="color:#a6e22e">sort</span>((<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) =&gt; <span style="color:#a6e22e">RankElement</span>(<span style="color:#a6e22e">b</span>[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span> <span style="color:#a6e22e">RankElement</span>(<span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>]));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">strokeColor</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">backgroundColor</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">fillStyle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">fillStyle</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeWidth</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">strokeWidth</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeStyle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">strokeStyle</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">roughness</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">roughness</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">opacity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">opacity</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">basePolygons</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>.<span style="color:#a6e22e">shift</span>().<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">element</span> =&gt; <span style="color:#a6e22e">traceElement</span>(<span style="color:#a6e22e">element</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">toolPolygons</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">groups</span>.<span style="color:#a6e22e">flatMap</span>(<span style="color:#a6e22e">group</span> =&gt; <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">element</span> =&gt; <span style="color:#a6e22e">traceElement</span>(<span style="color:#a6e22e">element</span>)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polyboolAction</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">regions</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">basePolygons</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">inverted</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">regions</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">toolPolygons</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">inverted</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">polygonHierachy</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">subordinateInnerPolygons</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">regions</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">drawPolygonHierachy</span>(<span style="color:#a6e22e">polygonHierachy</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">deleteViewElements</span>(<span style="color:#a6e22e">elements</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addElementsToView</span>(<span style="color:#66d9ef">false</span>,<span style="color:#66d9ef">false</span>,<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">traceElement</span>(<span style="color:#a6e22e">element</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">diamondPath</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">diamond</span>) =&gt; [
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">SxVEC</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">height</span>]),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">SxVEC</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">addVec</span>([<span style="color:#a6e22e">SxVEC</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">height</span>]), ([<span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">0</span>])]),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">addVec</span>([<span style="color:#a6e22e">SxVEC</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">0</span>]), ([<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">height</span>])]),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">SxVEC</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">diamond</span>.<span style="color:#a6e22e">height</span>])
</span></span><span style="display:flex;"><span>    ];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rectanglePath</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">rectangle</span>) =&gt; [
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">height</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">height</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ellipsePath</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">ellipse</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">angle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ellipse</span>.<span style="color:#a6e22e">angle</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ellipse</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ellipse</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ellipseAtPoint</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">t</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spanningVector</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>Math.<span style="color:#a6e22e">cos</span>(<span style="color:#a6e22e">t</span>), <span style="color:#a6e22e">height</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>Math.<span style="color:#a6e22e">sin</span>(<span style="color:#a6e22e">t</span>)];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">baseVector</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">height</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">addVec</span>([<span style="color:#a6e22e">spanningVector</span>, <span style="color:#a6e22e">baseVector</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">points</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>Math.<span style="color:#a6e22e">PI</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">t</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>Math.<span style="color:#a6e22e">PI</span>; <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">step</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">ellipseAtPoint</span>(<span style="color:#a6e22e">t</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">points</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">polygon</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">correctForPolygon</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">type</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;diamond&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">diamondPath</span>(<span style="color:#a6e22e">element</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;rectangle&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rectanglePath</span>(<span style="color:#a6e22e">element</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;ellipse&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ellipsePath</span>(<span style="color:#a6e22e">element</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;line&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;arrow&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">angle</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">smallestX</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">smallestY</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">point</span> =&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">smallestX</span>) <span style="color:#a6e22e">smallestX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">smallestY</span>) <span style="color:#a6e22e">smallestY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">point</span> =&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-=</span> <span style="color:#a6e22e">smallestX</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-=</span> <span style="color:#a6e22e">smallestY</span>
</span></span><span style="display:flex;"><span>          ];
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">correctForPolygon</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">smallestX</span>, <span style="color:#a6e22e">smallestY</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">roundness</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Notice</span>(<span style="color:#e6db74">&#34;This script does not work with curved lines or arrows yet!&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">points</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">angle</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">v</span> =&gt; <span style="color:#a6e22e">addVec</span>([<span style="color:#a6e22e">v</span>, [<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">y</span>]]));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">v</span> =&gt; <span style="color:#a6e22e">addVec</span>([<span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">SxVEC</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">height</span>])]));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rotateVectorsByAngle</span>(<span style="color:#a6e22e">polygon</span>, <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">angle</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">v</span> =&gt; <span style="color:#a6e22e">addVec</span>([<span style="color:#a6e22e">v</span>, [<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">y</span>], <span style="color:#a6e22e">SxVEC</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, [<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">height</span>]), <span style="color:#a6e22e">correctForPolygon</span>]));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">RankElement</span>(<span style="color:#a6e22e">element</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">score</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">backgroundRank</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dashed&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;hachure&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;zigzag&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;zigzag-line&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;cross-hatch&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;solid&#34;</span>
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">score</span> <span style="color:#f92672">+=</span> (<span style="color:#a6e22e">backgroundRank</span>.<span style="color:#a6e22e">findIndex</span>((<span style="color:#a6e22e">fillStyle</span>) =&gt; <span style="color:#a6e22e">fillStyle</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">fillStyle</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;transparent&#34;</span>) <span style="color:#a6e22e">score</span> <span style="color:#f92672">-=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">points</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">getVectorLength</span>(<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">points</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#a6e22e">score</span> <span style="color:#f92672">-=</span> <span style="color:#ae81ff">100</span>; 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">score</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) <span style="color:#a6e22e">score</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">score</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">opacity</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">score</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">drawPolygonHierachy</span>(<span style="color:#a6e22e">polygonHierachy</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundColor</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">strokeColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeColor</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">setInnerStyle</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">backgroundColor</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeColor</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">setBorderStyle</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">strokeColor</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">setFilledStyle</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">backgroundColor</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">strokeColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">strokeColor</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">polygonHierachy</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">polygon</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setFilledStyle</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">innerPolygons</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addLine</span>(<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outerBorder</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">innerPolygons</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">addInnerPolygons</span>(<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">innerPolygons</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">innerPolygons</span>.<span style="color:#a6e22e">backgroundPath</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setInnerStyle</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">backgroundId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addLine</span>(<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setBorderStyle</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outerBorderId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addLine</span>(<span style="color:#a6e22e">outerBorder</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">innerBorderIds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">innerPolygons</span>.<span style="color:#a6e22e">borderPaths</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">path</span> =&gt; <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addLine</span>(<span style="color:#a6e22e">path</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">allIds</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">innerBorderIds</span>, <span style="color:#a6e22e">outerBorderId</span>, <span style="color:#a6e22e">backgroundId</span>].<span style="color:#a6e22e">flat</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">addToGroup</span>(<span style="color:#a6e22e">allIds</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">background</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ea</span>.<span style="color:#a6e22e">getElement</span>(<span style="color:#a6e22e">backgroundId</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">background</span>.<span style="color:#a6e22e">groupIds</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">ShadowGroupMarker</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">outerBorderId</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addInnerPolygons</span>(<span style="color:#a6e22e">polygonHierachy</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">firstPath</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">secondPath</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">borderPaths</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">polygonHierachy</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">polygon</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderPaths</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">firstPath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">firstPath</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">secondPath</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">drawPolygonHierachy</span>(<span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">innerPolygons</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">backgroundPath</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">firstPath</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">secondPath</span>.<span style="color:#a6e22e">reverse</span>()), 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderPaths</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">borderPaths</span>
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">subordinateInnerPolygons</span>(<span style="color:#a6e22e">polygons</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">polygonObjectPrototype</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">polygon</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">polygon</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">innerPolygons</span><span style="color:#f92672">:</span> []
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">insertPolygonIntoHierachy</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">polygon</span>, <span style="color:#a6e22e">hierarchy</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">hierarchy</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">polygonObject</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hierarchy</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">inside</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pointIndex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inside</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pointInPolygon</span>(<span style="color:#a6e22e">polygon</span>[<span style="color:#a6e22e">pointIndex</span>], <span style="color:#a6e22e">polygonObject</span>.<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pointIndex</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">inside</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">inside</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">hierarchy</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">innerPolygons</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">insertPolygonIntoHierachy</span>(<span style="color:#a6e22e">polygon</span>, <span style="color:#a6e22e">hierarchy</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">innerPolygons</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hierarchy</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">polygon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygonObjectPrototype</span>(<span style="color:#a6e22e">polygon</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">hierarchy</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">polygonObject</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hierarchy</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">inside</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pointIndex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inside</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pointInPolygon</span>(<span style="color:#a6e22e">polygonObject</span>.<span style="color:#a6e22e">path</span>[<span style="color:#a6e22e">pointIndex</span>], <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pointIndex</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">inside</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">inside</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">innerPolygons</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">hierarchy</span>.<span style="color:#a6e22e">splice</span>(<span style="color:#a6e22e">i</span>, <span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hierarchy</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">polygon</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hierarchy</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">polygonHierachy</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">polygons</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">polygon</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">polygonHierachy</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">insertPolygonIntoHierachy</span>(<span style="color:#a6e22e">polygon</span>, <span style="color:#a6e22e">polygonHierachy</span>);
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">polygonHierachy</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Checks if the given point lays in the polygon
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param point array [x, y]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param polygon array [[x, y], ...]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns true if inside, false if not, null if the point is on one of the polygons vertecies
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">pointInPolygon</span>(<span style="color:#a6e22e">point</span>, <span style="color:#a6e22e">polygon</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">point</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">inside</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// odd even test if point is in polygon
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">polygon</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">xi</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>[<span style="color:#a6e22e">i</span>][<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">yi</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>[<span style="color:#a6e22e">i</span>][<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">xj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>[<span style="color:#a6e22e">j</span>][<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">yj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">polygon</span>[<span style="color:#a6e22e">j</span>][<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">intersect</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">yi</span> <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">yj</span> <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">x</span> <span style="color:#f92672">&lt;</span> ((<span style="color:#a6e22e">xj</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">xi</span>) <span style="color:#f92672">*</span> (<span style="color:#a6e22e">y</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">yi</span>)) <span style="color:#f92672">/</span> (<span style="color:#a6e22e">yj</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">yi</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">xi</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">intersect</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">inside</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">inside</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((<span style="color:#a6e22e">x</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">xi</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">yi</span>) <span style="color:#f92672">||</span> (<span style="color:#a6e22e">x</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">xj</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">yj</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">inside</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getVectorLength</span>(<span style="color:#a6e22e">vector</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> Math.<span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Adds two Vectors together
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addVec</span>(<span style="color:#a6e22e">vectors</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vectors</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">acc</span>, <span style="color:#a6e22e">vec</span>) =&gt; [<span style="color:#a6e22e">acc</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">vec</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">acc</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">vec</span>[<span style="color:#ae81ff">1</span>]], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Returns the negative of the vector
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">negVec</span>(<span style="color:#a6e22e">vector</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [<span style="color:#f92672">-</span><span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">0</span>], <span style="color:#f92672">-</span><span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">1</span>]];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Multiplies Vector with a scalar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">SxVEC</span>(<span style="color:#a6e22e">scalar</span>, <span style="color:#a6e22e">vector</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [<span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">scalar</span>, <span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">scalar</span>];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">rotateVector</span> (<span style="color:#a6e22e">vec</span>, <span style="color:#a6e22e">ang</span>)  {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cos</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">cos</span>(<span style="color:#a6e22e">ang</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sin</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">sin</span>(<span style="color:#a6e22e">ang</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [<span style="color:#a6e22e">vec</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">cos</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">vec</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">sin</span>, <span style="color:#a6e22e">vec</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">sin</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">vec</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">cos</span>];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">rotateVectorsByAngle</span>(<span style="color:#a6e22e">vectors</span>, <span style="color:#a6e22e">angle</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cosAngle</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">cos</span>(<span style="color:#a6e22e">angle</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sinAngle</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">sin</span>(<span style="color:#a6e22e">angle</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rotationMatrix</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">cosAngle</span>, <span style="color:#f92672">-</span><span style="color:#a6e22e">sinAngle</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#a6e22e">sinAngle</span>, <span style="color:#a6e22e">cosAngle</span>]
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">applyTranformationMatrix</span>(<span style="color:#a6e22e">vectors</span>, <span style="color:#a6e22e">rotationMatrix</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">applyTranformationMatrix</span>(<span style="color:#a6e22e">vectors</span>, <span style="color:#a6e22e">transformationMatrix</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vector</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">vectors</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vector</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">transformationMatrix</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">transformationMatrix</span>[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">transformationMatrix</span>[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">transformationMatrix</span>[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">push</span>([<span style="color:#a6e22e">newX</span>, <span style="color:#a6e22e">newY</span>]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>
</article>

    </main>

    <footer class="u-container u-py-xl u-text-center">
    <div class="u-mb-md">
        <span class="u-text-2xl">ðŸŒ±</span>
    </div>
    <p class="u-text-light">
        Â© 2025 Mengxi&#39;s Blog. Cultivated with intention.
    </p>
</footer>
</body>

</html>