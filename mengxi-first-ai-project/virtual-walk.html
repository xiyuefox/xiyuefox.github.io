<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Walk Adventures - Mengxi Times</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Unified Design System -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="css/unified-styles.css">

    <!-- Enhanced Game UI CSS -->
    <style>
        /* Specific overrides for Game UI */
        body.theme-education {
            /* Override background for full immersion if needed, or stick to theme */
            background: linear-gradient(135deg, var(--education-primary), var(--education-secondary));
            min-height: 100vh;
        }

        #map-container {
            height: 70vh;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-lg);
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.3);
        }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: var(--space-md);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        #controls {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        /* Status Bar */
        #statusBar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            color: white;
            font-weight: 700;
        }

        .energy-bar {
            width: 250px;
            height: 24px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #F9C74F, #F94144);
            /* Energy Colors */
            width: 100%;
            transition: width 0.3s ease;
        }

        #energyText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        #playerLevel {
            background: var(--education-accent);
            padding: 4px 12px;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }

        /* Leaflet Overrides */
        .leaflet-control-zoom {
            border: none !important;
            box-shadow: var(--shadow-md) !important;
        }

        /* Custom Buttons mapped to U-BTN but with specific game tweaks */
        .game-btn {
            background: rgba(255, 255, 255, 0.9);
            color: var(--education-text);
            font-weight: 700;
            border: none;
            transition: all 0.2s;
        }

        .game-btn:hover {
            transform: translateY(-2px);
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-btn-dir {
            background: #4CC9F0;
            color: white;
        }

        .game-btn-loc {
            background: #F72585;
            color: white;
        }

        .game-btn-layer {
            background: #4361EE;
            color: white;
        }

        @media (max-width: 768px) {
            #statusBar {
                flex-direction: column;
                text-align: center;
            }

            .energy-bar {
                width: 100%;
            }
        }
    </style>
</head>

<body class="theme-education">

    <!-- Unified Navigation -->
    <nav class="u-nav" style="background: rgba(255,255,255,0.9);">
        <div class="u-container u-nav__container">
            <a href="index.html" class="u-nav__brand">ğŸŒ¿ Mengxi Times</a>
            <ul class="u-nav__links">
                <li><a href="index.html" class="u-nav__link">é¦–é¡µ</a></li>
                <li><a href="little-learners-hub/index.html" class="u-nav__link">å­¦ä¹ ä¹å›­</a></li>
                <li><a href="#" class="u-nav__link u-nav__link--active">è™šæ‹Ÿæ—…è¡Œ</a></li>
            </ul>
        </div>
    </nav>

    <main class="u-container" style="padding-top: var(--space-xl);">
        <header class="u-text-center u-mb-xl" style="color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <h1 class="u-text-4xl u-font-bold">ğŸ® Virtual Walk Adventures</h1>
            <p class="u-text-lg">æ¢ç´¢ä¸–ç•Œä»å®¶å¼€å§‹ - æ¸¸æˆåŒ–è™šæ‹Ÿæ—…è¡Œ</p>
        </header>

        <!-- Status Bar -->
        <div id="statusBar" class="glass-panel">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <span id="playerLevel">ç­‰çº§ 1</span>
                <div class="energy-bar">
                    <div id="energyFill" class="energy-fill"></div>
                    <span id="energyText">100/100</span>
                </div>
            </div>
            <div id="gestureStatus">å½“å‰çŠ¶æ€: å°±ç»ª</div>
        </div>

        <!-- Map Area -->
        <div id="map-container"></div>

        <!-- Control Panel -->
        <div id="controls" class="glass-panel">
            <button class="u-btn game-btn game-btn-dir" id="btn-forward">â†‘ å‰è¿› (W)</button>
            <button class="u-btn game-btn game-btn-dir" id="btn-backward">â†“ åé€€ (S)</button>
            <button class="u-btn game-btn game-btn-dir" id="btn-left">â† å·¦è½¬ (A)</button>
            <button class="u-btn game-btn game-btn-dir" id="btn-right">â†’ å³è½¬ (D)</button>

            <button class="u-btn game-btn game-btn-loc" id="btn-paris">ğŸ—¼ å·´é»</button>
            <button class="u-btn game-btn game-btn-loc" id="btn-tokyo">ğŸ¯ ä¸œäº¬</button>
            <button class="u-btn game-btn game-btn-loc" id="btn-beijing">ğŸ° åŒ—äº¬</button>
            <button class="u-btn game-btn game-btn-loc" id="btn-shanghai">ğŸŒƒ ä¸Šæµ·</button>

            <button class="u-btn game-btn game-btn-layer" id="btn-layer">ğŸ—ºï¸ å«æ˜Ÿè§†å›¾</button>
        </div>

        <!-- Instructions -->
        <div class="glass-panel u-mt-lg" style="color: white;">
            <h3 class="u-text-xl u-font-bold u-mb-sm">ğŸ¯ æ“ä½œæŒ‡å—</h3>
            <ul style="list-style: none; line-height: 1.6;">
                <li><strong>æ–¹å‘æ§åˆ¶:</strong> ä½¿ç”¨é”®ç›˜ WASD/æ–¹å‘é”® æˆ– ç‚¹å‡»æŒ‰é’® è¿›è¡Œç§»åŠ¨</li>
                <li><strong>å¿«é€Ÿæ—…è¡Œ:</strong> ç‚¹å‡»åŸå¸‚æŒ‰é’®ç›´æ¥è·³è½¬åˆ°è¯¥åœ°ç‚¹</li>
                <li><strong>æ¢ç´¢:</strong> ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®å¯è·³è½¬åˆ°è¯¥åœ°ç‚¹</li>
            </ul>
        </div>
    </main>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --------------------------
        // æ¸¸æˆåŒ–è™šæ‹Ÿæ—…è¡Œ - æ ¸å¿ƒé€»è¾‘
        // --------------------------
        let map;
        let currentLocation = { lat: 48.8566, lng: 2.3522 }; // åˆå§‹ä½ç½®: å·´é»
        let currentZoom = 16;
        let isSatelliteMode = false;

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            energy: 100,
            level: 1,
            experience: 0
        };

        // é¢„è®¾åœ°ç‚¹åˆ—è¡¨
        const presetLocations = {
            paris: { lat: 48.8566, lng: 2.3522, name: "å·´é»", landmark: "åŸƒè²å°”é“å¡”" },
            tokyo: { lat: 35.6895, lng: 139.6917, name: "ä¸œäº¬", landmark: "ä¸œäº¬å¡”" },
            beijing: { lat: 39.9042, lng: 116.4074, name: "åŒ—äº¬", landmark: "å¤©å®‰é—¨" },
            shanghai: { lat: 31.2304, lng: 121.4737, name: "ä¸Šæµ·", landmark: "å¤–æ»©" }
        };

        // åœ°å›¾å›¾å±‚é…ç½®
        const standardLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        });

        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri',
            maxZoom: 19
        });

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            map = L.map('map-container', {
                center: currentLocation,
                zoom: currentZoom,
                layers: [standardLayer]
            });

            // æ·»åŠ ç”¨æˆ·ä½ç½®æ ‡è®°
            const userMarker = L.marker(currentLocation, {
                icon: L.divIcon({
                    className: 'user-marker',
                    html: '<div style="font-size: 30px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">ğŸƒ</div>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                })
            }).addTo(map);

            // æ·»åŠ é¢„è®¾åœ°ç‚¹æ ‡è®°
            for (const city in presetLocations) {
                const location = presetLocations[city];
                L.marker(location, {
                    icon: L.divIcon({
                        className: 'city-marker',
                        html: `<div style="font-size: 24px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">ğŸ“</div>`,
                        iconSize: [25, 25],
                        iconAnchor: [12, 12]
                    })
                })
                    .addTo(map)
                    .bindPopup(`<strong>${location.name}</strong><br>${location.landmark}`)
                    .on('click', () => goToPresetLocation(city));
            }

            // åœ°å›¾ç‚¹å‡»äº‹ä»¶
            map.on('click', (e) => {
                goToLocation(e.latlng.lat, e.latlng.lng, 'æ¢ç´¢ä½ç½®');
            });
        }

        // ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®
        function goToLocation(lat, lng, locationName = "") {
            currentLocation = { lat, lng };
            map.setView(currentLocation, currentZoom, { animate: true, duration: 1.2 });

            // æ›´æ–°ç”¨æˆ·æ ‡è®°
            const markers = map._layers;
            for (const id in markers) {
                if (markers[id]._icon && markers[id]._icon.classList.contains('user-marker')) {
                    markers[id].setLatLng(currentLocation);
                    break;
                }
            }

            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            updateGameStatus(locationName);
        }

        // åˆ‡æ¢åœ°å›¾å›¾å±‚
        function toggleLayer() {
            const btn = document.getElementById('btn-layer');
            isSatelliteMode = !isSatelliteMode;

            if (isSatelliteMode) {
                map.removeLayer(standardLayer);
                map.addLayer(satelliteLayer);
                btn.innerHTML = "ğŸ—ºï¸ æ ‡å‡†è§†å›¾";
            } else {
                map.removeLayer(satelliteLayer);
                map.addLayer(standardLayer);
                btn.innerHTML = "ğŸ—ºï¸ å«æ˜Ÿè§†å›¾";
            }
        }

        // é¢„è®¾åœ°ç‚¹å¯¼èˆª
        function goToPresetLocation(preset) {
            const location = presetLocations[preset];
            goToLocation(location.lat, location.lng, location.name);
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function updateGameStatus(locationName) {
            // æ›´æ–°èƒ½é‡
            gameState.energy = Math.min(100, gameState.energy - 1);
            // æ›´æ–°ç»éªŒ
            gameState.experience += 5;

            // å‡çº§æ£€æŸ¥
            if (gameState.experience >= gameState.level * 100) {
                gameState.level++;
                gameState.experience = 0;
                gameState.energy = 100; // å‡çº§æ»¡èƒ½é‡
                showMessage(`ğŸ‰ æ­å–œå‡çº§åˆ° ${gameState.level} çº§ï¼`, 'success');
            }

            // æ›´æ–°UI
            document.getElementById('playerLevel').textContent = `ç­‰çº§ ${gameState.level}`;
            document.getElementById('energyText').textContent = `${gameState.energy}/100`;
            document.getElementById('energyFill').style.width = `${gameState.energy}%`;
            document.getElementById('gestureStatus').textContent = `å½“å‰çŠ¶æ€: æ­£åœ¨æ¢ç´¢ ${locationName}`;
        }

        // é”®ç›˜å¯¼èˆª
        const moveDistance = 0.0012; // ç§»åŠ¨è·ç¦»
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            const move = { lat: 0, lng: 0 };

            if (key === 'arrowup' || key === 'w') move.lat += moveDistance;
            if (key === 'arrowdown' || key === 's') move.lat -= moveDistance;
            if (key === 'arrowleft' || key === 'a') move.lng -= moveDistance;
            if (key === 'arrowright' || key === 'd') move.lng += moveDistance;

            if (move.lat !== 0 || move.lng !== 0) {
                e.preventDefault();
                currentLocation.lat += move.lat;
                currentLocation.lng += move.lng;
                goToLocation(currentLocation.lat, currentLocation.lng, 'æ­¥è¡Œæ¢ç´¢');
            }
        });

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message`;
            messageDiv.innerHTML = `<strong>${type === 'success' ? 'ğŸ‰' : 'â„¹ï¸'} ${message}</strong>`;
            messageDiv.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? 'var(--education-primary)' : 'var(--education-secondary)'};
                color: white;
                border-radius: var(--radius-md);
                z-index: 10000;
                box-shadow: var(--shadow-lg);
                animation: slideInRight 0.3s ease, slideOutRight 0.3s ease 3s forwards;
            `;

            // æ·»åŠ åŠ¨ç”» CSS (inline for simplicity in this utility)
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
                @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
            `;
            document.head.appendChild(style);
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                if (messageDiv.parentNode) messageDiv.parentNode.removeChild(messageDiv);
                if (style.parentNode) style.parentNode.removeChild(style);
            }, 3500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initMap();

            document.getElementById('btn-forward').addEventListener('click', () => { currentLocation.lat += moveDistance; goToLocation(currentLocation.lat, currentLocation.lng, 'æ­¥è¡Œæ¢ç´¢'); });
            document.getElementById('btn-backward').addEventListener('click', () => { currentLocation.lat -= moveDistance; goToLocation(currentLocation.lat, currentLocation.lng, 'æ­¥è¡Œæ¢ç´¢'); });
            document.getElementById('btn-left').addEventListener('click', () => { currentLocation.lng -= moveDistance; goToLocation(currentLocation.lat, currentLocation.lng, 'æ­¥è¡Œæ¢ç´¢'); });
            document.getElementById('btn-right').addEventListener('click', () => { currentLocation.lng += moveDistance; goToLocation(currentLocation.lat, currentLocation.lng, 'æ­¥è¡Œæ¢ç´¢'); });

            document.getElementById('btn-paris').addEventListener('click', () => goToPresetLocation('paris'));
            document.getElementById('btn-tokyo').addEventListener('click', () => goToPresetLocation('tokyo'));
            document.getElementById('btn-beijing').addEventListener('click', () => goToPresetLocation('beijing'));
            document.getElementById('btn-shanghai').addEventListener('click', () => goToPresetLocation('shanghai'));
            document.getElementById('btn-layer').addEventListener('click', toggleLayer);

            setTimeout(() => {
                showMessage('ğŸ® Virtual Walk Adventures å·²å‡†å¤‡å°±ç»ªï¼', 'success');
            }, 500);
        });
    </script>
</body>

</html>